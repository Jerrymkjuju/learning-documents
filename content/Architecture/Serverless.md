### 微服务的缺陷

1. 引入治理组件。以容器为基础的微服务，带来的基础设施成本也是微服务实施的新挑战（弹性方面不足）。
2. 微服务划分主要依据单一职责，按业务抽象。
   1. 粒度较粗的时候，存在不同接口**QPS差异较大**，**变更频率不同**的情况。
   2. 粒度较细的时候，服务数量会增多，给服务维护和基础设施管理带来负担。
3. 不论是否上云，对运维人员的要求都比较高
4. 收费方式**按照资源大小及以小时为单位（或包年）计费的方式**，不能【用多少付多少】

### Serverless

#### what

1. 计算机资源由云服务商按需分配
2. 计算无状态，**结果保存在外部存储中**
3. 不使用应用时，不分配资源（计费基于实际消耗的资源来度量）

开发者专注于应用程序的业务逻辑

运维专注于业务运维

#### 系统架构

![image-20220116211627424](/Users/zhangmk/Documents/private/code/gitlab/learning-documents/images/typora/Serverless/image-20220116211627424.png)

##### Event Source

事件源，事件的生产者

##### Trigger

函数的REST呈现，通常是RESTful URL.

##### FaaS

function as a service. 业务逻辑已事件驱动的方式运行在无状态的临时容器中。

**FaaS控制器（FaaS Controller）**：FaaS平台的核心组件，管理函数的生命周期、扩容和缩容等。可以将函数实例缩容为0，同时在收到对函数的请求时迅速启动新的函数实例

**函数实例（Function Instance）**：执行函数的环境，包含函数代码、函数运行环境（如JRE、Node.js）、上下文信息（如函数运行的配置，通常以环境变量注入）。

**函数编程模型（Programming Model）**：通常表现为函数的编码规范，如签名、入口的方法名等。函数的编程模型一般会提供同步/异步/异常处理机制，开发者只需要处理输入（事件、上下文），并返回结果即可；

##### BaaS

backend as a service. 基于API的第三方服务，用来取代应用程序中功能的核心子集。这些API是作为自动扩展和透明运行的服务提供。

非计算类的全托管服务，如消息队列等中间件、NoSQL数据库服务、身份验证服务等，都可以认为是BaaS服务。

不用关心这些服务的扩容和缩容问题；



#### 需要注意的问题

1. 传统的基础设施通常都是从1到n扩容的，而Serverless平台需要支持从0到n扩容，以更快的扩容速度应对流量的变化，Serverless平台可达到秒级甚至毫秒级的扩容速度；
2. 函数被请求时才会创建实例，该准备过程会消耗较长的时间，影响函数的启动性能。同理，对于新到达的并发请求，会产生并发的冷启动问题。Serverless平台需要降低冷启动时延，以满足应用对性能的诉求；
3. 函数需要将状态或数据存放在后端BaaS服务中，而对接这些服务往往需要繁杂的API，Serverless平台的函数实例生命周期通常较短，对于如RDS数据库等后端服务无法保持长连接，为此，Serverless平台需要为函数提供完备、高效、可靠的BaaS服务连接/访问接口；
4. Serverless是逻辑多租的服务，租户的函数代码可能运行在同一台服务器上，所以，通常Serverless平台会采用安全容器的方式，引入轻量级虚拟化技术来保证隔离性，但这同时会引入额外的性能（启动）和资源开销等问题。



[架构师之路原文](https://mp.weixin.qq.com/s/g_BIjJVX31QDCUTLDTheVw)

作者推荐**《华为Serverless核心技术与实践》**

