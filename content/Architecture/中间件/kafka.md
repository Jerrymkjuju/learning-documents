# 重平衡策略

## Range

**这种分配是基于每个主题的分区分配**

如果主题的分区分区不能平均分配给组内每个消费者，那么对该主题，某些消费者会被分配到额外的分区

> **举例**：目前有两个消费者C0和C1，两个主题t0和t1，每个主题三个分区，分别是t0p0，t0p1，t0p2，和t1p0，t1p1，t1p2。
>
> 那么分配情况会是：
>
> - C0：t0p0, t0p1, t1p0, t1p1
> - C1：t0p2, t1p2

## RoundRobin

RoundRobin是基于全部主题的分区来进行分配的，同时这种分配也是kafka默认的rebalance分区策略

> **举例**：两个消费者C0和C1，两个主题t0和t1，每个主题三个分区，分别是t0p0，t0p1，t0p2，和t1p0，t1p1，t1p2。
>
> 由于是基于全部主题的分区，那么分配情况会是：
>
> - C0：t0p0, t0p1, t1p1
> - C1：t1p0, t0p2, t1p2

> **同一组内的消费者订阅不同的主题，那么仍然可能会导致分区不均衡的情况。**

## Sticky

**这种分配策略是在0.11.0才被提出来的**

主要是为了让目前的分配尽可能保持不变，只挪动尽可能少的分区来实现重平衡。

> 还是举例说明，有三个消费者C0，C1，C2 。三个主题t0，t1，t2，t3。每个主题各有两个分区， t0p0，t0p1，t1p0，t1p1，t2p0，t2p1，t3p0，t3p1。
>
> 现在订阅情况如下：
>
> - C0：t0p0，t1p1，t3p0
> - C1：t0p1，t2p0，t3p1
> - C2：t1p0，t2p1
>
> 假设现在C1挂掉了，如果是RoundRobin分配策略，那么会变成下面这样：
>
> - C0：t0p0，t1p0，t2p0，t3p0
> - C2：t0p1，t1p1，t2p1，t3p1
>
> 就是说它会全部重新打乱，再分配，而如何使用Sticky分配策略，会变成这样：
>
> - C0：t0p0，t1p1，t3p0，t2p0
> - C2：t1p0，t2p1，t0p1，t3p1
>
> 也就是说，尽可能保留了原来的分区情况，不去改变它，在这个基础上进行均衡分配，不过这个策略目前似乎还有些bug，所以实际使用也不多