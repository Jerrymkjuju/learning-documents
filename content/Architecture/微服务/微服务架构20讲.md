### 1.微服务特点

**松散耦合 loosely coupled**

**面向服务架构 service oriented architechure**

**有界上下文 with bounded Context 有独立数据源**（挑战：数据一致性？）

1. 一组小的服务
2. 独立的进程
3. 轻量级通信
4. 基于业务能力
5. 独立部署
6. 无集中式管理

### 2.微服务的利弊

| 利                                     | 弊                               |
| -------------------------------------- | -------------------------------- |
| 强模块化边界                           | 分布式复杂性；服务较多           |
| 可独立部署                             | 最终一致性                       |
| 技术多样性、不同团队可使用不同的技术栈 | 运维复杂性（服务的可靠性、稳定性 |
|                                        | 测试复杂性                       |

### 3.康威法则

**服务架构** 和 **组织架构** 互相影响

服务的维护 不需要依赖或者较少依赖 其他团队

### 4.微服务的适用性

前期单体应用的生产力较高，微服务因为需要一定的基础建设，所以生产力上单体 > 微服务

随着组织架构规模的变大，复杂性越来越大，研发生产力会逐渐降低（因为一个更新需要多个部门协调配合），此时就需要拆分为微服务（单体 < 微服务）

单块优先 -> 逐步的将功能点拆出来（陆续的梳理出领域模型），而非一开始就按微服务架构去做。



架构是设计出来的，还是演化出来的？ 我理解是演化出来的。没有最好的架构，只有最合适的架构。

### 5.适合微服务的架构

End-end ownership(端到端的) 从方案到设计到开发、上线，形成一个闭环（由平台团队提供基础能力）。更适合微服务。可以更好的、更快速的业务迭代。

传统的组织架构是按职能划分(产品、设计、开发、测试、运维)，问题的响应会变慢。

*现在公司内部的组织架构是混合两种形态的。按业务线区分各个职能线，职能线也会进行整体的管理。相当于技术需要两头汇报。*

*理想是好的，缺点就是管理层需要进行更多的沟通和同步，需要面对技术和业务两头上级的任务分配。在资源管理上需要投入更多的经历*

### 6.中台战略

业务前台：各种应用、第三方渠道

业务中台：核心业务层

技术中台：大数据、商业智能， PaaS云平台（应用监控、服务框架、资源调度）、IaaS（Infras 基础设施层）	

### 7.8 服务分层方式

业务相关：

1. 聚合裁剪服务（相当于AppServer/Web）

2. 基础服务(相当于公司的dc)

架构总体体系：6层

<img src="/Users/zhangmk/Documents/private/code/gitlab/learning-documents/images/typora/微服务架构20讲/image-20220116211526503.png" alt="image-20220116211526503" style="zoom:50%;" />

### 9.服务发现、负载均衡机制

1. 传统LB 硬件的F5，软件的Nginx

   a. 集中的LB(可能会有单点问题)

   b. 有一些性能开销，consumer调用服务，必须穿透LB

2. 进程内LB（consumer内部的）
   1. 服务注册发现机制、负载均衡，无集中LB
   2. 多语言的话，需要为每种语言开发对应的LB，维护成本高
3. 主机独立进程LB（客户端主机上独立部署，consumer调用本机上的LB-服务注册发现）
   1. 运维成本高

思考：serviceMesh使用的是哪种。 应该是第三种

### 10.网关

作用：

	1. 反向路由：将外部请求转为内部服务的调用
	1. 认证安全：guard（爬虫、hack攻击）
	1. 限流熔断
	1. 日志监控

思考：业务逻辑加入到网关层的好处和坏处

#### Netflix zuul 架构



<img src="/Users/zhangmk/Documents/private/code/gitlab/learning-documents/images/typora/微服务架构20讲/image-20220116211443332.png" alt="image-20220116211443332" style="zoom:50%;" />



<img src="/Users/zhangmk/Documents/private/code/gitlab/learning-documents/images/typora/微服务架构20讲/image-20220116101128650.png" alt="image-20220116101128650" style="zoom:50%;" />



### 11.集中式配置中心

Apollo - 推拉结合

高可用：Apollo客户端除了内存缓存外，还有本地文件缓存

### 12.RPC&Rest

### 13.微服务的治理

### 14.调用链

Google的dapper

### 18.容错限制